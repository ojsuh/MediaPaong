<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPaong by P I New</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Internal Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }
        
        /* Animasi Loading Awal */
        #logo-p, #logo-i { stroke-dasharray: 500; stroke-dashoffset: 500; }
        #logo-p { animation: draw 2s ease-in-out forwards; }
        #logo-i { animation: draw 2s ease-in-out forwards 0.5s; }
        #logo-new { opacity: 0; animation: fadeIn 1s ease-in-out forwards 2s; }
        @keyframes draw { to { stroke-dashoffset: 0; } }
        @keyframes fadeIn { to { opacity: 1; } }
        
        /* Animasi Transisi Halaman & Modal */
        .app-page, #message-modal { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        .page-enter { opacity: 0; transform: translateY(10px); }
        .page-enter-active { opacity: 1; transform: translateY(0); }
        .page-leave { opacity: 1; transform: translateY(0); }
        .page-leave-active { opacity: 0; transform: translateY(-10px); }
        .hidden-visually { opacity: 0; pointer-events: none; }

        /* Styling Navigasi */
        .nav-link, #logout-button {
            display: flex; flex-direction: column; align-items: center; padding: 0.5rem;
            border-radius: 0.5rem; color: #9ca3af; transition: all 0.2s; cursor: pointer;
        }
        .nav-link.active, .nav-link:hover { background-color: #374151; color: white; }
        #logout-button:hover { background-color: #991b1b; color: white; }
        .nav-link span, #logout-button span { font-size: 0.75rem; margin-top: 0.25rem; }
        @media (min-width: 768px) {
            .nav-link, #logout-button { flex-direction: row; justify-content: flex-start; gap: 0.75rem; }
            .nav-link span, #logout-button span { font-size: 1rem; margin-top: 0; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased overflow-hidden">

    <!-- ===== HALAMAN LOADING ===== -->
    <div id="loading-screen" class="fixed inset-0 bg-gray-900 flex flex-col justify-center items-center z-50">
        <div class="w-32 h-32 mb-4">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><path id="logo-p" d="M 50 150 L 50 50 L 110 50 C 140 50 140 80 110 80 L 50 80" stroke="#4f46e5" stroke-width="12" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path id="logo-i" d="M 150 150 L 150 110" stroke="#818cf8" stroke-width="12" fill="none" stroke-linecap="round"/><circle cx="150" cy="90" r="6" fill="#818cf8" /><text id="logo-new" x="90" y="145" font-family="Inter, sans-serif" font-size="30" fill="#c7d2fe" font-weight="bold">New</text></svg>
        </div>
        <p class="text-xl font-semibold text-gray-300 animate-pulse">MediaPaong By P I New</p>
    </div>

    <!-- ===== KONTEN DINAMIS (AUTH, APP, DOWNLOAD) ===== -->
    <div id="root-container"></div>
    
    <!-- ===== TEMPLATE KONTEN (HIDDEN) ===== -->
    <template id="auth-template">
        <div class="min-h-screen w-full flex flex-col justify-center items-center p-4" style="background-image: url('https://images.unsplash.com/photo-1501854140801-50d01698950b?q=80&w=2400&auto=format&fit=crop'); background-size: cover; background-position: center;">
            <div id="auth-card-container" class="w-full max-w-md">
                <!-- FORM LOGIN -->
                <div id="login-form" class="auth-form-card">
                    <form class="space-y-6">
                        <h2 class="text-3xl font-bold text-center text-white">Selamat Datang Kembali</h2>
                        <div><label for="login-email" class="text-sm font-medium text-gray-300">Email</label><input id="login-email" type="email" required autocomplete="email" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com"></div>
                        <div><label for="login-password" class="text-sm font-medium text-gray-300">Password</label><div class="relative"><input id="login-password" type="password" required autocomplete="current-password" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••"><button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white"><i data-lucide="eye"></i></button></div><a href="#" class="auth-link text-sm text-indigo-400 hover:underline mt-2 block text-right" data-form="forgot-password-form">Lupa Password?</a></div>
                        <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center disabled:bg-indigo-400"><span class="btn-text">Masuk</span><svg class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button>
                        <p class="text-sm text-center text-gray-400">Belum punya akun? <a href="#" class="auth-link font-medium text-indigo-400 hover:underline" data-form="register-form">Daftar di sini</a></p>
                    </form>
                </div>
                <!-- FORM REGISTER -->
                <div id="register-form" class="auth-form-card hidden">
                     <form class="space-y-6">
                        <h2 class="text-3xl font-bold text-center text-white">Buat Akun Baru</h2>
                        <div><label for="register-email" class="text-sm font-medium text-gray-300">Email</label><input id="register-email" type="email" required autocomplete="email" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com"></div>
                        <div><label for="register-password" class="text-sm font-medium text-gray-300">Password</label><div class="relative"><input id="register-password" type="password" required autocomplete="new-password" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Minimal 6 karakter"><button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white"><i data-lucide="eye"></i></button></div></div>
                        <div><label for="register-confirm-password" class="text-sm font-medium text-gray-300">Konfirmasi Password</label><div class="relative"><input id="register-confirm-password" type="password" required autocomplete="new-password" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ulangi password"><button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white"><i data-lucide="eye"></i></button></div></div>
                        <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center disabled:bg-indigo-400"><span class="btn-text">Daftar</span><svg class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button>
                        <p class="text-sm text-center text-gray-400">Sudah punya akun? <a href="#" class="auth-link font-medium text-indigo-400 hover:underline" data-form="login-form">Masuk</a></p>
                    </form>
                </div>
                <!-- FORM LUPA PASSWORD -->
                <div id="forgot-password-form" class="auth-form-card hidden">
                    <form class="space-y-6">
                        <h2 class="text-3xl font-bold text-center text-white">Reset Password</h2>
                        <p class="text-center text-gray-400">Masukkan email Anda untuk menerima link reset password.</p>
                        <div><label for="forgot-email" class="text-sm font-medium text-gray-300">Email</label><input id="forgot-email" type="email" required autocomplete="email" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com"></div>
                        <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center disabled:bg-indigo-400"><span class="btn-text">Kirim Link Reset</span><svg class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button>
                        <p class="text-sm text-center text-gray-400"><a href="#" class="auth-link font-medium text-indigo-400 hover:underline" data-form="login-form">Kembali ke Login</a></p>
                    </form>
                </div>
                <!-- FORM UPDATE PASSWORD -->
                <div id="update-password-form" class="auth-form-card hidden">
                    <form class="space-y-6">
                        <h2 class="text-3xl font-bold text-center text-white">Buat Password Baru</h2>
                        <div><label for="update-password" class="text-sm font-medium text-gray-300">Password Baru</label><div class="relative"><input id="update-password" type="password" required autocomplete="new-password" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Minimal 6 karakter"><button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white"><i data-lucide="eye"></i></button></div></div>
                        <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center disabled:bg-indigo-400"><span class="btn-text">Simpan Password Baru</span><svg class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button>
                    </form>
                </div>
            </div>
        </div>
    </template>
    
    <template id="app-template">
        <div class="h-screen flex flex-col md:flex-row">
            <!-- NAVIGASI SAMPING -->
            <nav class="bg-gray-800 order-last md:order-first md:w-64 p-2 md:p-4 flex md:flex-col justify-around md:justify-start md:space-y-4">
                <a href="#dashboard" class="nav-link" data-page="dashboard-page"><i data-lucide="layout-dashboard"></i><span>Dashboard</span></a>
                <a href="#ai-agent" class="nav-link" data-page="ai-agent-page"><i data-lucide="bot"></i><span>AI Agent</span></a>
                <a href="#report" class="nav-link" data-page="report-page"><i data-lucide="send"></i><span>Lapor/Bantuan</span></a>
                <a href="#info" class="nav-link" data-page="info-page"><i data-lucide="info"></i><span>Info</span></a>
                <a href="#profile" class="nav-link" data-page="profile-page"><i data-lucide="user-circle"></i><span>Profil</span></a>
                <button id="logout-button" class="w-full text-left"><i data-lucide="log-out"></i><span>Keluar</span></button>
            </nav>
            <!-- KONTEN UTAMA APLIKASI -->
            <main id="main-content" class="flex-1 overflow-y-auto p-4 md:p-8 relative">
                <!-- Halaman akan dirender di sini -->
            </main>
        </div>
    </template>

    <!-- TEMPLATE UNTUK SETIAP HALAMAN DI DALAM APLIKASI -->
    <template id="page-dashboard">
        <h1 class="text-4xl font-bold mb-6">Dashboard</h1><div class="bg-gray-800 p-6 rounded-2xl mb-8 shadow-lg"><h2 class="text-2xl font-semibold mb-4">Upload File atau APK Baru</h2><form id="upload-form"><div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 transition-colors"><input type="file" id="file-input" class="hidden"><label for="file-input" class="cursor-pointer"><i data-lucide="upload-cloud" class="mx-auto h-12 w-12 text-gray-400"></i><p class="mt-2 text-sm text-gray-400"><span class="font-semibold text-indigo-400">Klik untuk upload</span> atau seret file ke sini</p><p id="file-name-display" class="mt-1 text-xs text-gray-500"></p></label></div><button type="submit" class="mt-4 w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center disabled:bg-indigo-400"><span id="upload-button-text">Pilih file untuk diupload</span><svg id="upload-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button></form></div><div><h2 class="text-2xl font-semibold mb-4">File Anda</h2><div id="file-list" class="space-y-4"><p class="text-gray-400">Memuat file...</p></div></div>
    </template>
    
    <template id="page-ai-agent">
        <div class="h-full flex flex-col md:flex-row gap-4">
            <div class="flex-1 flex flex-col h-full bg-gray-800 rounded-2xl shadow-lg">
                <div id="chat-window" class="flex-1 p-6 overflow-y-auto space-y-4"><div class="flex items-start gap-3"><div class="bg-indigo-600 p-2 rounded-full flex-shrink-0"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div><div class="bg-gray-700 p-4 rounded-lg rounded-tl-none max-w-lg"><p>Halo, selamat datang di MediaPaong! Saya Asisten Virtual P I New. Ada yang bisa saya bantu jelaskan tentang aplikasi ini atau perusahaan kami?</p></div></div></div>
                <div class="p-4 border-t border-gray-700"><form id="chat-form" class="flex items-center gap-4"><input id="chat-input" type="text" placeholder="Tanya tentang P I New atau MediaPaong..." class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-full text-white"><button type="submit" class="p-3 bg-indigo-600 rounded-full text-white hover:bg-indigo-700"><i data-lucide="send" class="w-6 h-6"></i></button></form></div>
            </div>
            <div class="md:w-1/3 bg-gray-800 rounded-2xl p-6 overflow-y-auto shadow-lg">
                <h1 class="text-2xl font-bold text-white mb-4">Asisten Virtual P I New</h1>
                <div class="space-y-6"><div><h3 class="font-semibold text-lg text-indigo-400 mb-2">Tentang "Otak" AI Ini</h3><p class="text-sm text-gray-300">Saya adalah model AI dari Google Gemini yang telah diberi instruksi khusus untuk bertindak sebagai asisten virtual untuk **P I New**. "Otak" saya pada dasarnya adalah **Node.js konseptual**; saya telah diberi seperangkat data dan aturan untuk memahami konteks pertanyaan Anda seputar MediaPaong dan P I New.</p></div><div><h3 class="font-semibold text-lg text-indigo-400 mb-2">Pengetahuan Saya Meliputi:</h3><ul class="list-disc list-inside text-sm text-gray-300 space-y-1"><li>**Informasi Perusahaan:** Visi, misi, dan detail tentang P I New.</li><li>**Tutorial MediaPaong:** Cara upload, download, dan menggunakan fitur lainnya.</li><li>**Informasi Umum & Algoritma:** Konsep dasar tentang cara kerja aplikasi, keamanan data, dan teknologi di baliknya.</li><li>**Gaya Bahasa:** Saya diinstruksikan untuk berbicara dengan ramah dan menggunakan bahasa sehari-hari agar mudah dimengerti.</li></ul></div></div>
            </div>
        </div>
    </template>
    
    <template id="page-report">
        <h1 class="text-4xl font-bold mb-6">Lapor Masalah atau Minta Bantuan</h1><div class="bg-gray-800 p-6 rounded-2xl shadow-lg"><p class="text-gray-400 mb-6">Punya pertanyaan, keluhan, atau butuh bantuan? Isi form di bawah ini. Laporan Anda akan dikirim langsung ke tim kami. Kami akan membalasnya melalui email Anda.</p><form id="report-form" class="space-y-4"><div><label for="report-subject" class="text-sm font-medium text-gray-300">Subjek</label><input id="report-subject" type="text" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md" placeholder="Contoh: Gagal upload file"></div><div><label for="report-message" class="text-sm font-medium text-gray-300">Pesan Anda</label><textarea id="report-message" required rows="6" class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md" placeholder="Jelaskan masalah atau pertanyaan Anda secara detail di sini..."></textarea></div><button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors flex items-center justify-center disabled:bg-indigo-400"><span class="btn-text">Kirim Laporan</span><svg class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button></form></div><div class="mt-8"><h2 class="text-2xl font-semibold mb-4">Riwayat Laporan Anda</h2><div id="report-history" class="space-y-4"><p class="text-gray-400">Memuat riwayat...</p></div></div>
    </template>
    
    <template id="page-info">
        <h1 class="text-4xl font-bold mb-6">Info & Bantuan</h1><div class="space-y-8"><div class="bg-gray-800 p-6 rounded-2xl shadow-lg"><h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="book-open" class="text-indigo-400"></i> Tutorial Penggunaan</h2><ol class="list-decimal list-inside space-y-2 text-gray-300"><li><strong>Upload File:</strong> Masuk ke Dashboard, klik area upload, pilih file/APK Anda, lalu tekan tombol "Upload".</li><li><strong>Dapatkan Link:</strong> Setelah upload berhasil, link publik akan muncul di daftar file Anda. Klik ikon salin untuk membagikannya.</li><li><strong>Gunakan AI Agent:</strong> Buka menu AI Agent untuk bertanya apa saja seputar P I New.</li><li><strong>Kirim Laporan:</strong> Jika ada kendala, buka menu "Lapor/Bantuan", isi form, dan tim kami akan merespon via email.</li><li><strong>Kelola Profil:</strong> Di halaman Profil, Anda bisa melihat email dan mengganti foto profil Anda.</li></ol></div><div class="bg-gray-800 p-6 rounded-2xl shadow-lg"><h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="shield-check" class="text-green-400"></i> Keamanan Akun Anda</h2><ul class="list-disc list-inside space-y-2 mt-2 text-gray-300"><li>Gunakan password yang kuat dan unik.</li><li>Jangan pernah membagikan password Anda kepada siapa pun.</li><li>Semua file dan data Anda diamankan dengan Row Level Security (RLS) di Supabase.</li></ul></div></div>
    </template>
    
    <template id="page-profile">
        <h1 class="text-4xl font-bold mb-6">Profil Saya</h1><div class="max-w-lg mx-auto bg-gray-800 p-8 rounded-2xl shadow-lg text-center"><div class="relative w-32 h-32 mx-auto mb-4"><img id="profile-avatar" src="https://placehold.co/128x128/374151/e5e7eb?text=Profil" class="rounded-full w-full h-full object-cover border-4 border-indigo-500"><label for="avatar-upload" class="absolute bottom-0 right-0 bg-indigo-600 rounded-full p-2 cursor-pointer hover:bg-indigo-700 transition-colors"><i data-lucide="camera" class="w-5 h-5 text-white"></i><input type="file" id="avatar-upload" accept="image/*" class="hidden"></label></div><p id="profile-email" class="text-xl font-medium text-gray-200">memuat email...</p><p class="text-sm text-gray-400 mt-1">Pengguna MediaPaong</p></div>
    </template>

    <template id="download-template">
        <div class="min-h-screen flex flex-col justify-center items-center p-4 bg-gray-800" style="background-image: url('https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?q=80&w=2560&auto=format&fit=crop'); background-size: cover; background-position: center;"><div id="download-card" class="w-full max-w-md p-8 space-y-6 bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-2xl shadow-2xl text-center hidden"><i data-lucide="file-check-2" class="mx-auto h-16 w-16 text-indigo-400"></i><h2 class="text-2xl font-bold text-white break-words" id="download-filename">Nama File.apk</h2><p class="text-gray-400">Anda akan mengunduh file ini.</p><button id="download-button" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 transition-colors duration-300 flex items-center justify-center"><span id="download-button-text">Download Sekarang</span><svg id="download-spinner" class="animate-spin ml-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></button></div><div id="download-loading" class="text-center"><svg class="animate-spin h-10 w-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-4 text-white">Mencari file...</p></div><div id="download-not-found" class="text-center hidden"><i data-lucide="file-x-2" class="mx-auto h-16 w-16 text-red-400"></i><h2 class="text-2xl font-bold text-white mt-4">File Tidak Ditemukan</h2><p class="text-gray-400 mt-2">Maaf, link download ini tidak valid atau file telah dihapus.</p></div></div>
    </template>

    <!-- ===== MODAL NOTIFIKASI ===== -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-20 z-50 hidden-visually">
        <div id="message-modal-content" class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full mx-4 border-l-4">
            <p id="message-modal-text"></p>
        </div>
    </div>

    <script>
        // ========================================================================
        // APLIKASI UTAMA (MODULAR & STABIL)
        // ========================================================================
        const App = {
            // ----- KONFIGURASI & STATE -----
            config: {
                supabaseUrl: 'https://ldlauwjioniiucmeqneg.supabase.co',
                supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkbGF1d2ppb25paXVjbWVxbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MTEyMzcsImV4cCI6MjA2OTI4NzIzN30.l1iMpIDzmxqLn2lj4a9KR6lCohmsrXHKwMdlnbhTs-A',
                geminiApiKey: "AIzaSyBSGzNtCPMRpYQaYiRwMwHEF07YEqhR-EI",
            },
            state: {
                supabase: null,
                user: null,
                currentPage: null,
                chatHistory: [],
                systemPrompt: `Anda adalah asisten virtual yang sangat membantu dan ramah dari perusahaan bernama "P I New". Tugas Anda adalah membantu pengguna memahami aplikasi "MediaPaong" dan perusahaan P I New. Selalu gunakan bahasa sehari-hari yang santai, jelas, dan mudah dimengerti. HINDARI bahasa yang terlalu teknis atau kaku. Anda harus menggunakan basis pengetahuan di bawah ini untuk menjawab pertanyaan. Jika pertanyaan di luar konteks, jawablah dengan sopan bahwa Anda tidak memiliki informasi tersebut tetapi bisa memberikan informasi umum. === BASIS PENGETAHUAN P I NEW === 1. **Tentang Perusahaan P I New:** * **Nama:** P I New (singkatan dari Paong Inspiration New). * **Visi:** Menjadi platform terdepan yang menyediakan solusi digital inovatif, mudah digunakan, dan aman bagi semua orang. * **Misi:** Menciptakan aplikasi seperti MediaPaong yang mempermudah manajemen dan berbagi file, serta memberdayakan pengguna dengan teknologi AI yang mudah diakses. * **Pendiri:** Didirikan oleh sekelokompok pengembang yang terinspirasi untuk membuat teknologi lebih mudah diakses (disebut saja "Tim Paong"). 2. **Tutorial & Cara Kerja MediaPaong:** * **Upload File:** "Gampang banget! Di halaman Dashboard, tinggal klik atau seret file/APK kamu ke kotak upload, terus klik tombol 'Upload'." * **Dapat Link:** "Setelah file berhasil diupload, link publiknya langsung muncul di daftar file. Klik aja ikon salin di sebelahnya, langsung bisa kamu bagikan!" * **Keamanan:** "Tenang aja, semua file kamu aman. Kami pakai sistem keamanan Row Level Security dari Supabase. Artinya, cuma kamu yang bisa akses dan kelola file-file kamu sendiri." * **Fitur Lapor:** "Kalau ada masalah atau mau tanya-tanya, masuk aja ke menu 'Lapor/Bantuan'. Laporan kamu bakal langsung masuk ke tim kami dan dibalas via email." 3. **Informasi Umum & Algoritma:** * **Teknologi:** "MediaPaong dibangun pakai teknologi web modern seperti HTML, CSS, dan JavaScript. Untuk backend dan databasenya, kita percayakan sama Supabase, yang dasarnya adalah database PostgreSQL yang kuat." * **Algoritma Download:** "Waktu kamu klik link download, sistem akan cari info file di database berdasarkan ID uniknya. Kalau ketemu, sistem akan ambil filenya langsung dari Supabase Storage dan kirim ke browser kamu buat di-download. Semuanya cepat dan aman!" * **Konsep Otak AI:** "Saya sendiri (AI ini) pakai teknologi dari Google Gemini. Bisa dibilang 'otak' saya itu seperti program Node.js konseptual. Saya diberi instruksi dan pengetahuan awal ini, jadi saya bisa jawab pertanyaan sesuai konteks P I New." =================================`
            },

            // ----- INISIALISASI -----
            init() {
                this.state.supabase = window.supabase.createClient(this.config.supabaseUrl, this.config.supabaseKey);
                this.state.chatHistory = [{ role: 'user', parts: [{ text: this.state.systemPrompt }] }, { role: 'model', parts: [{ text: "Oke, saya paham. Saya adalah asisten virtual P I New. Siap membantu!" }] }];
                
                window.addEventListener('hashchange', () => this.router());
                this.state.supabase.auth.onAuthStateChange((event, session) => {
                    this.state.user = session ? session.user : null;
                    this.router();
                });

                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    this.router();
                }, 2500);
            },

            // ----- ROUTER & RENDER -----
            async router() {
                const hash = window.location.hash.slice(1);
                const mainContainer = document.getElementById('root-container');
                
                if (hash.startsWith('download=')) {
                    mainContainer.innerHTML = document.getElementById('download-template').innerHTML;
                    this.services.handleDownloadPage(hash.split('=')[1]);
                } else if (this.state.user) {
                    if (hash.startsWith('access_token')) {
                         this.ui.renderAuthPage('update-password-form');
                    } else {
                        if (!document.getElementById('app-template-rendered')) {
                            this.ui.renderAppShell();
                        }
                        const page = hash || 'dashboard';
                        this.ui.showAppPage(page.replace('-page',''));
                    }
                } else {
                     this.ui.renderAuthPage();
                }
                lucide.createIcons();
            },

            ui: {
                renderAuthPage(initialForm = 'login-form') {
                    const root = document.getElementById('root-container');
                    const authTemplate = document.getElementById('auth-template');
                    if (root.innerHTML !== authTemplate.innerHTML) {
                        root.innerHTML = authTemplate.innerHTML;
                    }
                    this.showAuthForm(initialForm);
                    App.listeners.attachAuthListeners();
                    lucide.createIcons();
                },

                renderAppShell() {
                    const root = document.getElementById('root-container');
                    root.innerHTML = document.getElementById('app-template').innerHTML;
                    root.firstElementChild.id = 'app-template-rendered'; // Tandai bahwa shell sudah dirender
                    App.listeners.attachAppListeners();
                },
                
                showAppPage(pageId) {
                    if (App.state.currentPage === pageId) return; 
                    App.state.currentPage = pageId;
                    
                    const mainContent = document.getElementById('main-content');
                    if (!mainContent) return;

                    const templateId = 'page-' + pageId;
                    const template = document.getElementById(templateId);
                    
                    if (template) {
                        const oldPage = mainContent.querySelector('.app-page');
                        if (oldPage) {
                            oldPage.classList.add('page-leave', 'page-leave-active');
                            setTimeout(() => oldPage.remove(), 300);
                        }

                        const newPage = document.createElement('div');
                        newPage.className = 'app-page absolute inset-0 p-4 md:p-8 overflow-y-auto page-enter';
                        newPage.innerHTML = template.innerHTML;
                        mainContent.appendChild(newPage);
                        
                        requestAnimationFrame(() => {
                           newPage.classList.add('page-enter-active');
                        });
                        
                        document.querySelectorAll('.nav-link').forEach(link => {
                           link.classList.toggle('active', link.dataset.page === pageId + '-page');
                        });

                        App.services.loadPageData(pageId);
                        App.listeners.attachPageSpecificListeners(pageId);
                    }
                    lucide.createIcons();
                },
                
                showAuthForm(formId) {
                    document.querySelectorAll('.auth-form-card').forEach(form => form.classList.add('hidden'));
                    document.getElementById(formId)?.classList.remove('hidden');
                },

                showMessage(message, type = 'success') {
                    const modal = document.getElementById('message-modal');
                    const text = document.getElementById('message-modal-text');
                    const content = document.getElementById('message-modal-content');
                    if (!modal || !text || !content) return;
                    text.textContent = message;
                    content.className = 'bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full mx-4 border-l-4'; // Reset class
                    if (type === 'success') content.classList.add('border-green-500');
                    else if (type === 'error') content.classList.add('border-red-500');
                    else content.classList.add('border-indigo-500');
                    
                    modal.classList.remove('hidden-visually');
                    requestAnimationFrame(() => {
                      modal.classList.add('page-enter-active');
                    });
                    
                    setTimeout(() => {
                        modal.classList.remove('page-enter-active');
                        modal.classList.add('page-leave-active');
                        setTimeout(() => modal.classList.add('hidden-visually'), 300);
                    }, 3000);
                },
                
                appendChatMessage(text, sender, isTyping = false) {
                    const chatWindow = document.getElementById('chat-window');
                    if (!chatWindow) return;
                    const messageWrapper = document.createElement('div');
                    messageWrapper.className = 'flex items-start gap-3';
                    let messageContent;
                    if (sender === 'user') {
                        messageWrapper.classList.add('justify-end');
                        messageContent = `<div class="bg-indigo-600 p-4 rounded-lg rounded-br-none max-w-lg"><p class="text-white">${text}</p></div><div class="bg-gray-600 p-2 rounded-full flex-shrink-0"><i data-lucide="user" class="w-6 h-6 text-white"></i></div>`;
                    } else {
                        if (isTyping) {
                            messageWrapper.id = 'typing-indicator';
                            messageContent = `<div class="bg-indigo-600 p-2 rounded-full flex-shrink-0"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div><div class="bg-gray-700 p-4 rounded-lg rounded-tl-none"><div class="flex items-center gap-2"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:-0.3s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay:-0.15s;"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div></div></div>`;
                        } else {
                            messageContent = `<div class="bg-indigo-600 p-2 rounded-full flex-shrink-0"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div><div class="bg-gray-700 p-4 rounded-lg rounded-tl-none max-w-lg"><p>${text}</p></div>`;
                        }
                    }
                    messageWrapper.innerHTML = messageContent;
                    chatWindow.appendChild(messageWrapper);
                    lucide.createIcons();
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                },

                setButtonLoading(form, isLoading) {
                    const button = form.querySelector('button[type="submit"]');
                    if (!button) return;
                    button.disabled = isLoading;
                    button.querySelector('.btn-text')?.classList.toggle('hidden', isLoading);
                    button.querySelector('svg')?.classList.toggle('hidden', !isLoading);
                },
            },

            // ----- EVENT LISTENERS -----
            listeners: {
                attachAuthListeners() {
                    document.getElementById('login-form')?.addEventListener('submit', this.handlers.onLogin);
                    document.getElementById('register-form')?.addEventListener('submit', this.handlers.onRegister);
                    document.getElementById('forgot-password-form')?.addEventListener('submit', this.handlers.onForgotPassword);
                    document.getElementById('update-password-form')?.addEventListener('submit', this.handlers.onUpdatePassword);
                    document.querySelectorAll('.auth-link').forEach(link => link.addEventListener('click', e => { e.preventDefault(); App.ui.showAuthForm(e.target.dataset.form); }));
                    document.querySelectorAll('.toggle-password').forEach(btn => btn.addEventListener('click', this.handlers.onTogglePassword));
                },
                attachAppListeners() {
                    document.getElementById('logout-button')?.addEventListener('click', this.handlers.onLogout);
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const page = link.dataset.page;
                            window.location.hash = page.replace('-page', '');
                        });
                    });
                },
                attachPageSpecificListeners(pageId){
                     if(pageId === 'dashboard') {
                        document.getElementById('upload-form')?.addEventListener('submit', this.handlers.onUpload);
                        const fileInput = document.getElementById('file-input');
                        fileInput?.addEventListener('change', () => {
                            if (fileInput.files.length > 0) {
                                document.getElementById('file-name-display').textContent = fileInput.files[0].name;
                                document.querySelector('#upload-form button').disabled = false;
                                document.getElementById('upload-button-text').textContent = 'Upload Sekarang';
                            }
                        });
                    }
                    if(pageId === 'profile') {
                        document.getElementById('avatar-upload')?.addEventListener('change', this.handlers.onAvatarUpload);
                    }
                    if(pageId === 'report') {
                        document.getElementById('report-form')?.addEventListener('submit', this.handlers.onReportSubmit);
                    }
                    if(pageId === 'ai-agent') {
                        document.getElementById('chat-form')?.addEventListener('submit', this.handlers.onChatSubmit);
                    }
                },
                handlers: {
                    async onLogin(e) { e.preventDefault(); App.ui.setButtonLoading(e.target, true); const { error } = await App.state.supabase.auth.signInWithPassword({ email: e.target.querySelector('#login-email').value, password: e.target.querySelector('#login-password').value }); App.ui.setButtonLoading(e.target, false); if (error) App.ui.showMessage(`Login gagal: ${error.message}`, 'error'); else App.ui.showMessage('Login berhasil!'); },
                    async onRegister(e) { e.preventDefault(); const password = e.target.querySelector('#register-password').value; if (password.length < 6) return App.ui.showMessage('Password harus minimal 6 karakter.', 'error'); if (password !== e.target.querySelector('#register-confirm-password').value) return App.ui.showMessage('Password tidak cocok.', 'error'); App.ui.setButtonLoading(e.target, true); const { error } = await App.state.supabase.auth.signUp({ email: e.target.querySelector('#register-email').value, password: password }); App.ui.setButtonLoading(e.target, false); if (error) App.ui.showMessage(`Daftar gagal: ${error.message}`, 'error'); else { App.ui.showMessage('Pendaftaran berhasil! Cek email untuk verifikasi.', 'info'); App.ui.showAuthForm('login-form'); } },
                    async onForgotPassword(e) { e.preventDefault(); App.ui.setButtonLoading(e.target, true); const { error } = await App.state.supabase.auth.resetPasswordForEmail(e.target.querySelector('#forgot-email').value, { redirectTo: `${window.location.origin}${window.location.pathname}` }); App.ui.setButtonLoading(e.target, false); if (error) App.ui.showMessage(`Gagal mengirim link: ${error.message}`, 'error'); else { App.ui.showMessage('Link reset password telah dikirim.', 'info'); App.ui.showAuthForm('login-form'); } },
                    async onUpdatePassword(e) { e.preventDefault(); const password = e.target.querySelector('#update-password').value; if (password.length < 6) return App.ui.showMessage('Password baru harus minimal 6 karakter.', 'error'); App.ui.setButtonLoading(e.target, true); const { error } = await App.state.supabase.auth.updateUser({ password }); App.ui.setButtonLoading(e.target, false); if (error) App.ui.showMessage(`Gagal update password: ${error.message}`, 'error'); else { App.ui.showMessage('Password berhasil diperbarui!', 'success'); window.location.hash = ''; } },
                    async onLogout() { const { error } = await App.state.supabase.auth.signOut(); if (error) App.ui.showMessage('Logout gagal.', 'error'); },
                    onTogglePassword(e) { const input = e.currentTarget.previousElementSibling; const icon = e.currentTarget.querySelector('i'); if (input.type === 'password') { input.type = 'text'; icon.setAttribute('data-lucide', 'eye-off'); } else { input.type = 'password'; icon.setAttribute('data-lucide', 'eye'); } lucide.createIcons(); },
                    async onUpload(e) { e.preventDefault(); const file = e.target.querySelector('#file-input').files[0]; if (!file) return App.ui.showMessage('Pilih file.', 'error'); const button = e.target.querySelector('button'); App.ui.setButtonLoading(e.target, true); document.getElementById('upload-button-text').textContent = 'Mengupload...'; const filePath = `${App.state.user.id}/${Date.now()}-${file.name}`; try { const { error: uploadError } = await App.state.supabase.storage.from('uploads').upload(filePath, file); if (uploadError) throw uploadError; const { data: { publicUrl } } = App.state.supabase.storage.from('uploads').getPublicUrl(filePath); await App.state.supabase.from('files').insert({ user_id: App.state.user.id, file_name: file.name, file_path: filePath, public_url: publicUrl, file_size: file.size }); App.ui.showMessage('File berhasil diupload!', 'success'); App.services.loadUserFiles(App.state.user.id); } catch (error) { App.ui.showMessage(`Upload gagal: ${error.message}.`, 'error'); } finally { e.target.reset(); document.getElementById('file-name-display').textContent = ''; button.querySelector('.btn-text').textContent = 'Pilih file untuk diupload'; App.ui.setButtonLoading(e.target, false); button.disabled = true;} },
                    async onAvatarUpload(e) { const file = e.target.files[0]; if (!file) return; App.ui.showMessage('Mengupload foto profil...', 'info'); try { await App.state.supabase.storage.from('avatars').upload(`${App.state.user.id}/profile.png`, file, { upsert: true }); App.services.setupProfilePage(); App.ui.showMessage('Foto profil berhasil diperbarui!', 'success'); } catch (error) { App.ui.showMessage(`Gagal update foto: ${error.message}`, 'error'); } },
                    async onReportSubmit(e) { e.preventDefault(); const subject = e.target.querySelector('#report-subject').value; const message = e.target.querySelector('#report-message').value; App.ui.setButtonLoading(e.target, true); try { const { error } = await App.state.supabase.from('reports').insert({ user_id: App.state.user.id, user_email: App.state.user.email, subject, message }); if (error) throw error; App.ui.showMessage('Laporan Anda berhasil terkirim!', 'success'); e.target.reset(); App.services.loadReportHistory(App.state.user.id); } catch (error) { App.ui.showMessage(`Gagal mengirim laporan: ${error.message}`, 'error'); } finally { App.ui.setButtonLoading(e.target, false); } },
                    async onChatSubmit(e) { e.preventDefault(); const chatInput = document.getElementById('chat-input'); const userInput = chatInput.value.trim(); if (!userInput) return; App.ui.appendChatMessage(userInput, 'user'); chatInput.value = ''; App.state.chatHistory.push({ role: 'user', parts: [{ text: userInput }] }); App.ui.appendChatMessage('', 'bot', true); try { const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${App.config.geminiApiKey}`; const payload = { contents: App.state.chatHistory.slice(-10) }; const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) { const errData = await response.json(); throw new Error(errData.error.message); } const result = await response.json(); const botResponse = result.candidates[0].content.parts[0].text; App.state.chatHistory.push({ role: 'model', parts: [{ text: botResponse }] }); document.getElementById('typing-indicator')?.remove(); App.ui.appendChatMessage(botResponse, 'bot'); } catch (error) { document.getElementById('typing-indicator')?.remove(); App.ui.appendChatMessage(`Maaf, terjadi kesalahan saat menghubungi AI: ${error.message}`, 'bot'); } }
                }
            },
            
            // ----- SERVICES (LOGIKA BISNIS & DATA) -----
            services: {
                loadPageData(pageId){
                    if (pageId === 'dashboard') this.loadUserFiles(App.state.user.id);
                    if (pageId === 'report') this.loadReportHistory(App.state.user.id);
                    if (pageId === 'profile') this.setupProfilePage();
                },
                async loadUserFiles(userId) {
                    const container = document.getElementById('file-list');
                    if (!container) return;
                    const { data, error } = await App.state.supabase.from('files').select('*').eq('user_id', userId).order('created_at', { ascending: false });
                    if (error) return container.innerHTML = `<p class="text-red-400">Gagal memuat file.</p>`;
                    if (data.length === 0) return container.innerHTML = `<p class="text-gray-400">Anda belum mengupload file.</p>`;
                    container.innerHTML = data.map(file => { const link = `${window.location.href.split('#')[0]}#download=${file.id}`; return `<div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between shadow"><div class="flex items-center gap-4 overflow-hidden"><i data-lucide="file-text" class="text-indigo-400 flex-shrink-0"></i><div class="overflow-hidden"><p class="font-medium text-white truncate" title="${file.file_name}">${file.file_name}</p><p class="text-sm text-gray-400">${App.utils.formatBytes(file.file_size)}</p></div></div><div class="flex items-center gap-2 flex-shrink-0"><button class="copy-btn p-2 rounded-md hover:bg-gray-600" data-link="${link}" title="Salin Link"><i data-lucide="copy" class="w-5 h-5"></i></button><button class="delete-btn p-2 rounded-md text-red-400 hover:bg-red-900" data-file-id="${file.id}" data-file-path="${file.file_path}" title="Hapus"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div></div>` }).join('');
                    lucide.createIcons();
                    document.querySelectorAll('.copy-btn').forEach(btn => btn.addEventListener('click', (e) => App.utils.copyToClipboard(e.currentTarget.dataset.link)));
                    document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', (e) => this.deleteFile(e.currentTarget.dataset.fileId, e.currentTarget.dataset.filePath)));
                },
                 async deleteFile(fileId, filePath) {
                    if (!confirm('Yakin ingin menghapus file ini?')) return;
                    App.ui.showMessage('Menghapus file...', 'info');
                    try {
                        const { error: storageError } = await App.state.supabase.storage.from('uploads').remove([filePath]);
                        if (storageError) throw storageError;
                        const { error: dbError } = await App.state.supabase.from('files').delete().eq('id', fileId);
                        if(dbError) throw dbError;
                        App.ui.showMessage('File berhasil dihapus.', 'success');
                        this.loadUserFiles(App.state.user.id);
                    } catch (error) {
                        App.ui.showMessage(`Gagal hapus file: ${error.message}`, 'error');
                    }
                },
                async setupProfilePage() {
                    const emailEl = document.getElementById('profile-email');
                    const avatarEl = document.getElementById('profile-avatar');
                    if (emailEl) emailEl.textContent = App.state.user.email;
                    if (avatarEl) {
                        const { data } = App.state.supabase.storage.from('avatars').getPublicUrl(`${App.state.user.id}/profile.png`);
                        if (data.publicUrl) {
                             avatarEl.src = `${data.publicUrl}?t=${new Date().getTime()}`;
                        }
                    }
                },
                async loadReportHistory(userId) {
                    const container = document.getElementById('report-history');
                    if (!container) return;
                    const { data, error } = await App.state.supabase.from('reports').select('*').eq('user_id', userId).order('created_at', { ascending: false });
                    if (error) return container.innerHTML = '<p class="text-red-400">Gagal memuat riwayat.</p>';
                    if (data.length === 0) return container.innerHTML = '<p class="text-gray-400">Anda belum pernah mengirim laporan.</p>';
                    container.innerHTML = data.map(report => { const statusColor = report.status === 'baru' ? 'bg-blue-500' : 'bg-green-500'; return `<div class="bg-gray-700 p-4 rounded-lg"><div class="flex justify-between items-center"><h3 class="font-semibold text-white">${report.subject}</h3><span class="text-xs font-medium px-2 py-1 ${statusColor} rounded-full">${report.status}</span></div><p class="text-gray-400 mt-2 text-sm">${new Date(report.created_at).toLocaleString('id-ID')}</p></div>` }).join('');
                },
                async handleDownloadPage(fileId) {
                    const loading = document.getElementById('download-loading');
                    const card = document.getElementById('download-card');
                    const notFound = document.getElementById('download-not-found');
                    try {
                        const { data, error } = await App.state.supabase.from('files').select('file_name, file_path').eq('id', fileId).single();
                        if (error || !data) throw new Error('File tidak ditemukan di database.');
                        document.getElementById('download-filename').textContent = data.file_name;
                        loading.style.display = 'none';
                        card.classList.remove('hidden');
                        document.getElementById('download-button').addEventListener('click', async () => {
                            const button = document.getElementById('download-button');
                            App.ui.setButtonLoading({querySelector: () => button}, true);
                            try {
                                const { data: blob, error: dlError } = await App.state.supabase.storage.from('uploads').download(data.file_path);
                                if (dlError) throw dlError;
                                const link = document.createElement('a');
                                link.href = URL.createObjectURL(blob);
                                link.download = data.file_name;
                                document.body.appendChild(link);
                                link.click();
                                URL.revokeObjectURL(link.href);
                                link.remove();
                                button.querySelector('.btn-text').textContent = 'Download Selesai';
                            } catch (err) {
                                App.ui.showMessage(`Gagal unduh file: ${err.message}`, 'error');
                                button.querySelector('.btn-text').textContent = 'Download Gagal';
                            } finally {
                                App.ui.setButtonLoading({querySelector: () => button}, false);
                            }
                        });
                    } catch (err) {
                        loading.style.display = 'none';
                        notFound.classList.remove('hidden');
                    }
                     lucide.createIcons();
                }
            },
            
            // ----- UTILITIES -----
            utils: {
                formatBytes(bytes, decimals = 2) { if (!+bytes) return '0 Bytes'; const k = 1024; const dm = decimals < 0 ? 0 : decimals; const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`; },
                copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => App.ui.showMessage('Link download disalin!', 'success')); }
            }
        };

        // Mulai aplikasi saat dokumen siap
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>
