<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPaong by P I New</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@latest/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* Menggunakan font Inter sebagai default */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Styling untuk scrollbar agar lebih modern */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6366f1;
        }

        /* Animasi untuk Logo di Halaman Loading */
        #logo-p {
            stroke-dasharray: 500;
            stroke-dashoffset: 500;
            animation: draw 2s ease-in-out forwards;
        }
        #logo-i {
            stroke-dasharray: 200;
            stroke-dashoffset: 200;
            animation: draw 2s ease-in-out forwards 0.5s;
        }
        #logo-new {
            opacity: 0;
            animation: fadeIn 1s ease-in-out forwards 2s;
        }

        @keyframes draw {
            to {
                stroke-dashoffset: 0;
            }
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Efek blur pada background form */
        .backdrop-blur-sm {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }
        
        /* Animasi untuk modal */
        .modal-enter {
            animation: fadeIn 0.3s ease-out;
        }
        .modal-leave {
            animation: fadeOut 0.3s ease-in;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased">

    <!-- ===== HALAMAN LOADING ===== -->
    <div id="loading-screen" class="fixed inset-0 bg-gray-900 flex flex-col justify-center items-center z-50">
        <div class="w-32 h-32 mb-4">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <path id="logo-p" d="M 50 150 L 50 50 L 110 50 C 140 50 140 80 110 80 L 50 80" stroke="#4f46e5" stroke-width="12" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                <path id="logo-i" d="M 150 150 L 150 110" stroke="#818cf8" stroke-width="12" fill="none" stroke-linecap="round"/>
                <circle id="logo-i" cx="150" cy="90" r="6" fill="#818cf8" />
                <text id="logo-new" x="90" y="145" font-family="Inter, sans-serif" font-size="30" fill="#c7d2fe" font-weight="bold">New</text>
            </svg>
        </div>
        <p class="text-xl font-semibold text-gray-300 animate-pulse">MediaPaong By P I New</p>
    </div>

    <!-- ===== HALAMAN AUTENTIKASI (LOGIN, DAFTAR, LUPA PASSWORD) ===== -->
    <div id="auth-screen" class="min-h-screen hidden flex-col justify-center items-center p-4" style="background-image: url('https://images.unsplash.com/photo-1501854140801-50d01698950b?q=80&w=2400&auto=format&fit=crop'); background-size: cover; background-position: center;">
        <div class="w-full max-w-md p-8 space-y-6 bg-gray-800 bg-opacity-70 backdrop-blur-sm rounded-2xl shadow-2xl">
            <!-- Form Login -->
            <form id="login-form" class="space-y-6">
                <h2 class="text-3xl font-bold text-center text-white">Selamat Datang Kembali</h2>
                <div>
                    <label for="login-email" class="text-sm font-medium text-gray-300">Email</label>
                    <input id="login-email" type="email" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com">
                </div>
                <div>
                    <label for="login-password" class="text-sm font-medium text-gray-300">Password</label>
                    <div class="relative">
                        <input id="login-password" type="password" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••">
                        <button type="button" onclick="togglePasswordVisibility('login-password')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </div>
                    <a href="#" onclick="showAuthForm('forgot-password-form')" class="text-sm text-indigo-400 hover:underline mt-2 block text-right">Lupa Password?</a>
                </div>
                <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300">Masuk</button>
                <p class="text-sm text-center text-gray-400">Belum punya akun? <a href="#" onclick="showAuthForm('register-form')" class="font-medium text-indigo-400 hover:underline">Daftar di sini</a></p>
            </form>

            <!-- Form Daftar -->
            <form id="register-form" class="space-y-6 hidden">
                <h2 class="text-3xl font-bold text-center text-white">Buat Akun Baru</h2>
                <div>
                    <label for="register-email" class="text-sm font-medium text-gray-300">Email</label>
                    <input id="register-email" type="email" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com">
                </div>
                <div>
                    <label for="register-password" class="text-sm font-medium text-gray-300">Password</label>
                     <div class="relative">
                        <input id="register-password" type="password" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Minimal 6 karakter">
                        <button type="button" onclick="togglePasswordVisibility('register-password')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </div>
                </div>
                 <div>
                    <label for="register-confirm-password" class="text-sm font-medium text-gray-300">Konfirmasi Password</label>
                     <div class="relative">
                        <input id="register-confirm-password" type="password" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Ulangi password">
                        <button type="button" onclick="togglePasswordVisibility('register-confirm-password')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300">Daftar</button>
                <p class="text-sm text-center text-gray-400">Sudah punya akun? <a href="#" onclick="showAuthForm('login-form')" class="font-medium text-indigo-400 hover:underline">Masuk</a></p>
            </form>
            
            <!-- Form Lupa Password -->
            <form id="forgot-password-form" class="space-y-6 hidden">
                <h2 class="text-3xl font-bold text-center text-white">Reset Password</h2>
                <p class="text-center text-gray-400">Masukkan email Anda untuk menerima link reset password.</p>
                <div>
                    <label for="forgot-email" class="text-sm font-medium text-gray-300">Email</label>
                    <input id="forgot-email" type="email" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="nama@email.com">
                </div>
                <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300">Kirim Link Reset</button>
                <p class="text-sm text-center text-gray-400"><a href="#" onclick="showAuthForm('login-form')" class="font-medium text-indigo-400 hover:underline">Kembali ke Login</a></p>
            </form>

            <!-- Form Ganti Password (setelah klik link email) -->
            <form id="update-password-form" class="space-y-6 hidden">
                <h2 class="text-3xl font-bold text-center text-white">Buat Password Baru</h2>
                <div>
                    <label for="update-password" class="text-sm font-medium text-gray-300">Password Baru</label>
                    <div class="relative">
                        <input id="update-password" type="password" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Minimal 6 karakter">
                        <button type="button" onclick="togglePasswordVisibility('update-password')" class="absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </div>
                </div>
                <button type="submit" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300">Simpan Password Baru</button>
            </form>

        </div>
    </div>
    
    <!-- ===== APLIKASI UTAMA (Setelah Login) ===== -->
    <div id="app-screen" class="hidden h-screen flex flex-col md:flex-row">
        <!-- Navigasi (Bawah di mobile, Samping di desktop) -->
        <nav class="bg-gray-800 order-last md:order-first md:w-64 p-2 md:p-4 flex md:flex-col justify-around md:justify-start md:space-y-4">
             <a href="#dashboard" class="nav-link flex flex-col md:flex-row items-center space-x-0 md:space-x-3 p-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-colors" onclick="showAppPage('dashboard-page')">
                <i data-lucide="layout-dashboard"></i> <span class="text-xs md:text-base mt-1 md:mt-0">Dashboard</span>
            </a>
            <a href="#ai-agent" class="nav-link flex flex-col md:flex-row items-center space-x-0 md:space-x-3 p-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-colors" onclick="showAppPage('ai-agent-page')">
                <i data-lucide="bot"></i> <span class="text-xs md:text-base mt-1 md:mt-0">AI Agent</span>
            </a>
             <a href="#info" class="nav-link flex flex-col md:flex-row items-center space-x-0 md:space-x-3 p-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-colors" onclick="showAppPage('info-page')">
                <i data-lucide="info"></i> <span class="text-xs md:text-base mt-1 md:mt-0">Info & Bantuan</span>
            </a>
            <a href="#profile" class="nav-link flex flex-col md:flex-row items-center space-x-0 md:space-x-3 p-2 rounded-lg text-gray-400 hover:bg-gray-700 hover:text-white transition-colors" onclick="showAppPage('profile-page')">
                <i data-lucide="user-circle"></i> <span class="text-xs md:text-base mt-1 md:mt-0">Profil</span>
            </a>
            <button id="logout-button" class="flex flex-col md:flex-row items-center space-x-0 md:space-x-3 p-2 rounded-lg text-gray-400 hover:bg-red-800 hover:text-white transition-colors">
                 <i data-lucide="log-out"></i> <span class="text-xs md:text-base mt-1 md:mt-0">Keluar</span>
            </button>
        </nav>

        <!-- Konten Utama -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8">
            <!-- Halaman Dashboard -->
            <div id="dashboard-page" class="app-page">
                <h1 class="text-4xl font-bold mb-6">Dashboard</h1>
                
                <!-- Form Upload -->
                <div class="bg-gray-800 p-6 rounded-2xl mb-8 shadow-lg">
                    <h2 class="text-2xl font-semibold mb-4">Upload File atau APK Baru</h2>
                    <form id="upload-form">
                        <div class="border-2 border-dashed border-gray-600 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 transition-colors">
                            <input type="file" id="file-input" class="hidden">
                            <label for="file-input" class="cursor-pointer">
                                <i data-lucide="upload-cloud" class="mx-auto h-12 w-12 text-gray-400"></i>
                                <p class="mt-2 text-sm text-gray-400">
                                    <span class="font-semibold text-indigo-400">Klik untuk upload</span> atau seret file ke sini
                                </p>
                                <p id="file-name-display" class="mt-1 text-xs text-gray-500"></p>
                            </label>
                        </div>
                        <button type="submit" class="mt-4 w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300 flex items-center justify-center disabled:bg-gray-500" disabled>
                            <span id="upload-button-text">Pilih file untuk diupload</span>
                            <svg id="upload-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                               <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                               <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>
                    </form>
                </div>
                
                <!-- Daftar File yang Diupload -->
                <div>
                    <h2 class="text-2xl font-semibold mb-4">File Anda</h2>
                    <div id="file-list" class="space-y-4">
                        <!-- File akan ditampilkan di sini oleh JavaScript -->
                        <p class="text-gray-400">Anda belum mengupload file apapun.</p>
                    </div>
                </div>
            </div>

            <!-- Halaman AI Agent -->
            <div id="ai-agent-page" class="app-page hidden h-full flex flex-col">
                <h1 class="text-4xl font-bold mb-6">AI Agent (Gemini)</h1>
                <div class="bg-gray-800 rounded-2xl flex-1 flex flex-col shadow-lg">
                    <div id="chat-window" class="flex-1 p-6 overflow-y-auto space-y-4">
                        <!-- Pesan chat akan muncul di sini -->
                        <div class="flex items-start gap-3">
                            <div class="bg-indigo-600 p-2 rounded-full"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div>
                            <div class="bg-gray-700 p-4 rounded-lg rounded-tl-none max-w-lg">
                                <p>Halo! Saya adalah AI Agent dari Gemini. Ada yang bisa saya bantu? Tanyakan apa saja!</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t border-gray-700">
                        <form id="chat-form" class="flex items-center gap-4">
                            <input id="chat-input" type="text" placeholder="Ketik pesan Anda di sini..." class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-full text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <button type="submit" class="p-3 bg-indigo-600 rounded-full text-white hover:bg-indigo-700 transition-colors">
                                <i data-lucide="send" class="w-6 h-6"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Halaman Info & Bantuan -->
            <div id="info-page" class="app-page hidden">
                 <h1 class="text-4xl font-bold mb-6">Info & Bantuan</h1>
                 <div class="space-y-8">
                    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="book-open" class="text-indigo-400"></i> Tutorial Penggunaan</h2>
                        <ol class="list-decimal list-inside space-y-2 text-gray-300">
                            <li><strong>Upload File:</strong> Masuk ke Dashboard, klik area upload, pilih file/APK Anda, lalu tekan tombol "Upload".</li>
                            <li><strong>Dapatkan Link:</strong> Setelah upload berhasil, link publik akan muncul di daftar file Anda. Klik ikon salin untuk membagikannya.</li>
                            <li><strong>Gunakan AI Agent:</strong> Buka halaman AI Agent, ketik pertanyaan Anda, dan tekan kirim. AI akan merespon pertanyaan Anda.</li>
                            <li><strong>Kelola Profil:</strong> Di halaman Profil, Anda bisa melihat email dan mengganti foto profil Anda.</li>
                        </ol>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="shield-check" class="text-green-400"></i> Keamanan Akun Anda</h2>
                        <p class="text-gray-300">Kami sangat peduli dengan keamanan data Anda. Berikut beberapa tips:</p>
                        <ul class="list-disc list-inside space-y-2 mt-2 text-gray-300">
                            <li>Gunakan password yang kuat dan unik.</li>
                            <li>Jangan pernah membagikan password Anda kepada siapa pun.</li>
                            <li>Aktifkan verifikasi email untuk keamanan tambahan.</li>
                            <li>Semua file Anda disimpan dengan aman di Supabase Storage.</li>
                        </ul>
                    </div>
                     <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
                        <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2"><i data-lucide="zap" class="text-yellow-400"></i> Kemudahan MediaPaong</h2>
                        <p class="text-gray-300">MediaPaong dirancang untuk memberikan kemudahan bagi Anda dalam berbagi file:</p>
                         <ul class="list-disc list-inside space-y-2 mt-2 text-gray-300">
                            <li><strong>Penyimpanan Terpusat:</strong> Semua file Anda ada di satu tempat yang aman dan mudah diakses.</li>
                            <li><strong>Berbagi Cepat:</strong> Buat dan bagikan link download hanya dengan beberapa klik.</li>
                            <li><strong>Asisten Cerdas:</strong> Dapatkan bantuan dan jawaban cepat dari AI Agent yang terintegrasi.</li>
                            <li><strong>Antarmuka Modern:</strong> Desain yang bersih dan responsif, nyaman digunakan di perangkat apa pun.</li>
                        </ul>
                    </div>
                 </div>
            </div>

            <!-- Halaman Profil -->
            <div id="profile-page" class="app-page hidden">
                <h1 class="text-4xl font-bold mb-6">Profil Saya</h1>
                <div class="max-w-lg mx-auto bg-gray-800 p-8 rounded-2xl shadow-lg text-center">
                    <div class="relative w-32 h-32 mx-auto mb-4">
                        <img id="profile-avatar" src="https://placehold.co/128x128/374151/e5e7eb?text=Profil" class="rounded-full w-full h-full object-cover border-4 border-indigo-500">
                        <label for="avatar-upload" class="absolute bottom-0 right-0 bg-indigo-600 rounded-full p-2 cursor-pointer hover:bg-indigo-700 transition-colors">
                           <i data-lucide="camera" class="w-5 h-5 text-white"></i>
                           <input type="file" id="avatar-upload" accept="image/*" class="hidden">
                        </label>
                    </div>
                    <p id="profile-email" class="text-xl font-medium text-gray-200">memuat email...</p>
                    <p class="text-sm text-gray-400 mt-1">Pengguna MediaPaong</p>
                </div>
            </div>
        </main>
    </div>

    <!-- ===== HALAMAN DOWNLOAD PUBLIK ===== -->
    <div id="download-page" class="min-h-screen hidden flex-col justify-center items-center p-4 bg-gray-800" style="background-image: url('https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?q=80&w=2560&auto=format&fit=crop'); background-size: cover; background-position: center;">
        <div id="download-card" class="w-full max-w-md p-8 space-y-6 bg-gray-900 bg-opacity-80 backdrop-blur-sm rounded-2xl shadow-2xl text-center hidden">
            <i data-lucide="file-check-2" class="mx-auto h-16 w-16 text-indigo-400"></i>
            <h2 class="text-2xl font-bold text-white break-words" id="download-filename">Nama File.apk</h2>
            <p class="text-gray-400">Anda akan mengunduh file ini.</p>
            <button id="download-button" class="w-full py-3 px-4 text-white bg-indigo-600 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:ring-offset-gray-900 transition-colors duration-300 flex items-center justify-center">
                <span id="download-button-text">Download Sekarang</span>
                <svg id="download-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                   <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                   <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </div>
        <div id="download-loading" class="text-center">
             <svg class="animate-spin h-10 w-10 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-white">Mencari file...</p>
        </div>
         <div id="download-not-found" class="text-center hidden">
            <i data-lucide="file-x-2" class="mx-auto h-16 w-16 text-red-400"></i>
            <h2 class="text-2xl font-bold text-white mt-4">File Tidak Ditemukan</h2>
            <p class="text-gray-400 mt-2">Maaf, link download ini tidak valid atau file telah dihapus.</p>
        </div>
    </div>
    
    <!-- Modal Notifikasi -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-start pt-20 z-50 hidden modal-enter">
        <div id="message-modal-content" class="bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full mx-4 border-l-4">
            <p id="message-modal-text"></p>
        </div>
    </div>


    <script>
        // ========================================================================
        // KONFIGURASI DAN INISIALISASI SUPABASE
        // ========================================================================
        const supabaseUrl = 'https://ldlauwjioniiucmeqneg.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkbGF1d2ppb25paXVjbWVxbmVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MTEyMzcsImV4cCI6MjA2OTI4NzIzN30.l1iMpIDzmxqLn2lj4a9KR6lCohmsrXHKwMdlnbhTs-A';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // ========================================================================
        // VARIABEL GLOBAL DAN ELEMEN DOM
        // ========================================================================
        const loadingScreen = document.getElementById('loading-screen');
        const authScreen = document.getElementById('auth-screen');
        const appScreen = document.getElementById('app-screen');
        const downloadPage = document.getElementById('download-page');
        
        const allAuthForms = ['login-form', 'register-form', 'forgot-password-form', 'update-password-form'];
        const allAppPages = ['dashboard-page', 'ai-agent-page', 'info-page', 'profile-page'];
        
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const forgotPasswordForm = document.getElementById('forgot-password-form');
        const updatePasswordForm = document.getElementById('update-password-form');
        
        const uploadForm = document.getElementById('upload-form');
        const fileInput = document.getElementById('file-input');
        const fileNameDisplay = document.getElementById('file-name-display');
        const uploadButton = uploadForm.querySelector('button[type="submit"]');
        const uploadButtonText = document.getElementById('upload-button-text');
        const uploadSpinner = document.getElementById('upload-spinner');
        const fileListContainer = document.getElementById('file-list');

        const profileAvatar = document.getElementById('profile-avatar');
        const profileEmail = document.getElementById('profile-email');
        const avatarUploadInput = document.getElementById('avatar-upload');

        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatWindow = document.getElementById('chat-window');
        let chatHistory = []; // Untuk menyimpan riwayat chat dengan AI

        // ========================================================================
        // FUNGSI UTILITY & HELPER
        // ========================================================================

        // Fungsi untuk menampilkan modal notifikasi
        function showMessage(message, type = 'success') {
            const modal = document.getElementById('message-modal');
            const content = document.getElementById('message-modal-content');
            const text = document.getElementById('message-modal-text');

            text.textContent = message;
            content.className = 'bg-gray-800 rounded-lg shadow-xl p-6 max-w-sm w-full mx-4 border-l-4'; // reset
            if (type === 'success') {
                content.classList.add('border-green-500');
            } else if (type === 'error') {
                content.classList.add('border-red-500');
            } else {
                content.classList.add('border-indigo-500');
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('modal-enter');

            setTimeout(() => {
                modal.classList.add('modal-leave');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('modal-enter', 'modal-leave');
                }, 300);
            }, 3000);
        }
        
        // Fungsi untuk menampilkan/menyembunyikan password
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling.querySelector('svg');
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a10.05 10.05 0 013.4-5.25M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15a3 3 0 003-3M1.125 4.125l19.75 19.75"></path>`;
            } else {
                input.type = 'password';
                icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>`;
            }
        }

        // Fungsi untuk menavigasi antar form autentikasi
        function showAuthForm(formId) {
            allAuthForms.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(formId).classList.remove('hidden');
        }
        
        // Fungsi untuk menavigasi antar halaman di dalam aplikasi utama
        function showAppPage(pageId) {
            allAppPages.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            
            // Update active state di navigasi
            document.querySelectorAll('.nav-link').forEach(link => {
                if (link.getAttribute('href') === `#${pageId.replace('-page', '')}`) {
                    link.classList.add('bg-gray-700', 'text-white');
                    link.classList.remove('text-gray-400');
                } else {
                    link.classList.remove('bg-gray-700', 'text-white');
                    link.classList.add('text-gray-400');
                }
            });
        }
        
        // Fungsi untuk memformat ukuran file
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // ========================================================================
        // LOGIKA APLIKASI UTAMA (Setelah window dimuat)
        // ========================================================================
        window.onload = async () => {
            lucide.createIcons(); // Inisialisasi ikon
            
            const params = new URLSearchParams(window.location.hash.substring(1));
            const path = window.location.pathname;
            const fileId = params.get('file');
            
            // Logika untuk halaman download
            if (path.startsWith('/download')) {
                const idFromPath = path.split('/')[2];
                if(idFromPath) {
                    loadingScreen.classList.add('hidden');
                    authScreen.classList.add('hidden');
                    appScreen.classList.add('hidden');
                    downloadPage.classList.remove('hidden');
                    await handleDownloadPage(idFromPath);
                }
                return;
            }
            
            // Cek apakah ada sesi password reset
            if (params.has('access_token') && params.get('type') === 'recovery') {
                setTimeout(() => {
                    loadingScreen.classList.add('hidden');
                    authScreen.classList.remove('hidden');
                    showAuthForm('update-password-form');
                }, 1000);
                return;
            }
            
            // Periksa sesi pengguna yang ada
            const { data: { session } } = await supabase.auth.getSession();

            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                if (session) {
                    authScreen.classList.add('hidden');
                    appScreen.classList.remove('hidden');
                    setupApp(session.user);
                } else {
                    authScreen.classList.remove('hidden');
                    appScreen.classList.add('hidden');
                    showAuthForm('login-form');
                }
            }, 2500); // Tampilkan loading screen selama 2.5 detik
        };

        // ========================================================================
        // LOGIKA AUTENTIKASI
        // ========================================================================
        
        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                showMessage(`Login gagal: ${error.message}`, 'error');
            } else {
                showMessage('Login berhasil! Mengalihkan ke dashboard...');
                authScreen.classList.add('hidden');
                appScreen.classList.remove('hidden');
                setupApp(data.user);
            }
        });

        // Daftar
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if(password.length < 6) {
                showMessage('Password harus minimal 6 karakter.', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('Password dan konfirmasi password tidak cocok!', 'error');
                return;
            }

            const { data, error } = await supabase.auth.signUp({ email, password });

            if (error) {
                showMessage(`Pendaftaran gagal: ${error.message}`, 'error');
            } else {
                showMessage('Pendaftaran berhasil! Silakan cek email Anda untuk verifikasi.', 'info');
                showAuthForm('login-form');
            }
        });

        // Lupa Password
        forgotPasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgot-email').value;
            
            const { error } = await supabase.auth.resetPasswordForEmail(email, {
                redirectTo: window.location.origin, // Link akan kembali ke halaman utama
            });

            if (error) {
                showMessage(`Gagal mengirim link: ${error.message}`, 'error');
            } else {
                showMessage('Link reset password telah dikirim ke email Anda.', 'info');
                showAuthForm('login-form');
            }
        });

        // Ganti Password Baru
        updatePasswordForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('update-password').value;
            
             if(password.length < 6) {
                showMessage('Password baru harus minimal 6 karakter.', 'error');
                return;
            }

            const { error } = await supabase.auth.updateUser({ password });

            if (error) {
                showMessage(`Gagal mengganti password: ${error.message}`, 'error');
            } else {
                showMessage('Password berhasil diperbarui! Silakan login dengan password baru Anda.', 'success');
                // Hapus hash dari URL
                history.pushState("", document.title, window.location.pathname + window.location.search);
                showAuthForm('login-form');
            }
        });

        // Logout
        document.getElementById('logout-button').addEventListener('click', async () => {
            await supabase.auth.signOut();
            showMessage('Anda telah keluar.');
            authScreen.classList.remove('hidden');
            appScreen.classList.add('hidden');
        });

        // Listener untuk perubahan status autentikasi
        supabase.auth.onAuthStateChange((event, session) => {
            if (event === 'PASSWORD_RECOVERY') {
                authScreen.classList.remove('hidden');
                appScreen.classList.add('hidden');
                showAuthForm('update-password-form');
            } else if (event === 'SIGNED_IN') {
                 // Cek apakah halaman download yang aktif, jika ya, jangan redirect
                if (!downloadPage.classList.contains('hidden')) return;

                authScreen.classList.add('hidden');
                appScreen.classList.remove('hidden');
                setupApp(session.user);
            } else if (event === 'SIGNED_OUT') {
                authScreen.classList.remove('hidden');
                appScreen.classList.add('hidden');
            }
        });


        // ========================================================================
        // LOGIKA APLIKASI SETELAH LOGIN
        // ========================================================================
        
        // Fungsi untuk setup aplikasi setelah login
        function setupApp(user) {
            showAppPage('dashboard-page');
            loadUserFiles(user.id);
            setupProfilePage(user);
        }

        // --- Logika Upload File ---
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;
                uploadButton.disabled = false;
                uploadButtonText.textContent = 'Upload Sekarang';
            }
        });

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const file = fileInput.files[0];
            if (!file) {
                showMessage('Silakan pilih file terlebih dahulu.', 'error');
                return;
            }
            
            const user = (await supabase.auth.getUser()).data.user;
            if (!user) {
                showMessage('Sesi tidak valid, silakan login kembali.', 'error');
                return;
            }

            uploadButton.disabled = true;
            uploadSpinner.classList.remove('hidden');
            uploadButtonText.textContent = 'Mengupload...';

            // Membuat path file yang unik untuk menghindari tumpang tindih
            const filePath = `${user.id}/${Date.now()}-${file.name}`;
            
            try {
                // 1. Upload ke Supabase Storage
                // Pastikan Anda sudah membuat bucket bernama 'uploads' di Supabase Storage
                // dan mengatur RLS policy agar pengguna yang terautentikasi bisa upload.
                const { error: uploadError } = await supabase.storage
                    .from('uploads')
                    .upload(filePath, file);

                if (uploadError) throw uploadError;

                // 2. Dapatkan URL publik dari file yang diupload
                const { data: publicUrlData } = supabase.storage
                    .from('uploads')
                    .getPublicUrl(filePath);

                // 3. Simpan metadata file ke tabel 'files' di database
                // Pastikan Anda sudah membuat tabel 'files' dengan kolom:
                // id (uuid, primary), user_id (uuid, foreign key ke auth.users),
                // file_name (text), file_path (text), public_url (text), file_size (bigint), created_at (timestampz)
                const { error: dbError } = await supabase
                    .from('files')
                    .insert({
                        user_id: user.id,
                        file_name: file.name,
                        file_path: filePath,
                        public_url: publicUrlData.publicUrl,
                        file_size: file.size,
                    });
                
                if (dbError) throw dbError;

                showMessage('File berhasil diupload!', 'success');
                loadUserFiles(user.id); // Muat ulang daftar file

            } catch (error) {
                showMessage(`Upload gagal: ${error.message}`, 'error');
            } finally {
                uploadForm.reset();
                fileNameDisplay.textContent = '';
                uploadButton.disabled = true;
                uploadSpinner.classList.add('hidden');
                uploadButtonText.textContent = 'Pilih file untuk diupload';
            }
        });
        
        // --- Memuat dan Menampilkan File Pengguna ---
        async function loadUserFiles(userId) {
            const { data, error } = await supabase
                .from('files')
                .select('*')
                .eq('user_id', userId)
                .order('created_at', { ascending: false });

            if (error) {
                showMessage(`Gagal memuat file: ${error.message}`, 'error');
                fileListContainer.innerHTML = `<p class="text-red-400">Gagal memuat file.</p>`;
                return;
            }

            if (data.length === 0) {
                fileListContainer.innerHTML = `<p class="text-gray-400">Anda belum mengupload file apapun.</p>`;
                return;
            }

            fileListContainer.innerHTML = data.map(file => {
                // Membuat link download unik per file
                const downloadLink = `${window.location.origin}/download/${file.id}`;
                return `
                    <div class="bg-gray-700 p-4 rounded-lg flex items-center justify-between shadow">
                        <div class="flex items-center gap-4 overflow-hidden">
                            <i data-lucide="file-text" class="text-indigo-400 flex-shrink-0"></i>
                            <div class="overflow-hidden">
                                <p class="font-medium text-white truncate">${file.file_name}</p>
                                <p class="text-sm text-gray-400">${formatBytes(file.file_size)}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <button onclick="copyToClipboard('${downloadLink}')" title="Salin Link Download" class="p-2 rounded-md hover:bg-gray-600 transition-colors">
                                <i data-lucide="copy" class="w-5 h-5"></i>
                            </button>
                             <button onclick="deleteFile('${file.id}', '${file.file_path}')" title="Hapus File" class="p-2 rounded-md text-red-400 hover:bg-red-900 hover:text-red-300 transition-colors">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        // --- Fungsi Hapus File ---
        async function deleteFile(fileId, filePath) {
            if (!confirm('Apakah Anda yakin ingin menghapus file ini? Tindakan ini tidak dapat diurungkan.')) {
                return;
            }

            try {
                // Hapus dari Storage
                const { error: storageError } = await supabase.storage.from('uploads').remove([filePath]);
                if(storageError) throw storageError;

                // Hapus dari Database
                const { error: dbError } = await supabase.from('files').delete().eq('id', fileId);
                if(dbError) throw dbError;
                
                showMessage('File berhasil dihapus.', 'success');
                const user = (await supabase.auth.getUser()).data.user;
                loadUserFiles(user.id);

            } catch(error) {
                showMessage(`Gagal menghapus file: ${error.message}`, 'error');
            }
        }

        // --- Fungsi Salin ke Clipboard ---
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Link download berhasil disalin!', 'success');
            }, (err) => {
                showMessage('Gagal menyalin link.', 'error');
            });
        }
        
        // --- Logika Halaman Profil ---
        function setupProfilePage(user) {
            profileEmail.textContent = user.email;
            const avatarUrl = user.user_metadata.avatar_url;
            if (avatarUrl) {
                profileAvatar.src = avatarUrl;
            }
        }
        
        avatarUploadInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const user = (await supabase.auth.getUser()).data.user;
            const filePath = `public/${user.id}/profile.png`;
            
            showMessage('Mengupload foto profil...', 'info');

            try {
                // Upload ke bucket 'avatars' dengan opsi upsert untuk menimpa
                const { error: uploadError } = await supabase.storage
                    .from('avatars')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: true,
                    });
                if (uploadError) throw uploadError;

                // Dapatkan URL publik
                 const { data: { publicUrl } } = supabase.storage
                    .from('avatars')
                    .getPublicUrl(filePath);

                // Update metadata pengguna
                const { data, error: updateError } = await supabase.auth.updateUser({
                    data: { avatar_url: `${publicUrl}?t=${new Date().getTime()}` } // Tambah timestamp untuk bust cache
                });

                if (updateError) throw updateError;
                
                profileAvatar.src = data.user.user_metadata.avatar_url;
                showMessage('Foto profil berhasil diperbarui!', 'success');

            } catch (error) {
                showMessage(`Gagal mengupdate foto: ${error.message}`, 'error');
            }
        });

        // --- Logika AI Agent (Gemini) ---
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const userInput = chatInput.value.trim();
            if (!userInput) return;

            // Tampilkan pesan pengguna di chat window
            appendMessage(userInput, 'user');
            chatInput.value = '';

            // Simpan ke riwayat
            chatHistory.push({ role: 'user', parts: [{ text: userInput }] });

            // Tampilkan indikator "mengetik"
            appendMessage('', 'bot', true);

            try {
                // Panggil API Gemini
                // Model yang digunakan adalah gemini-2.5-flash-preview-05-20 seperti instruksi
                const apiKey = ""; // API Key tidak diperlukan saat dijalankan di lingkungan Google
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                // Kirim 5 interaksi terakhir (10 pesan) untuk menjaga konteks
                const payload = {
                    contents: chatHistory.slice(-10) 
                };
                
                const response = await fetch(apiUrl, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || 'Terjadi kesalahan pada API');
                }

                const result = await response.json();
                const botResponse = result.candidates[0].content.parts[0].text;
                
                // Simpan balasan bot ke riwayat
                chatHistory.push({ role: 'model', parts: [{ text: botResponse }] });

                // Hapus indikator "mengetik" dan tampilkan balasan bot
                document.getElementById('typing-indicator').remove();
                appendMessage(botResponse, 'bot');

            } catch (error) {
                 document.getElementById('typing-indicator').remove();
                 appendMessage(`Maaf, terjadi kesalahan: ${error.message}`, 'bot');
            }
        });

        function appendMessage(text, sender, isTyping = false) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = 'flex items-start gap-3';
            
            let messageContent;

            if (sender === 'user') {
                messageWrapper.classList.add('justify-end');
                messageContent = `
                    <div class="bg-indigo-600 p-4 rounded-lg rounded-br-none max-w-lg">
                        <p class="text-white">${text}</p>
                    </div>
                    <div class="bg-gray-600 p-2 rounded-full"><i data-lucide="user" class="w-6 h-6 text-white"></i></div>
                `;
            } else { // bot
                if (isTyping) {
                    messageWrapper.id = 'typing-indicator';
                    messageContent = `
                        <div class="bg-indigo-600 p-2 rounded-full"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div>
                        <div class="bg-gray-700 p-4 rounded-lg rounded-tl-none">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: -0.3s;"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: -0.15s;"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            </div>
                        </div>
                    `;
                } else {
                    messageContent = `
                        <div class="bg-indigo-600 p-2 rounded-full"><i data-lucide="bot" class="w-6 h-6 text-white"></i></div>
                        <div class="bg-gray-700 p-4 rounded-lg rounded-tl-none max-w-lg">
                            <p>${text}</p>
                        </div>
                    `;
                }
            }
            
            messageWrapper.innerHTML = messageContent;
            chatWindow.appendChild(messageWrapper);
            lucide.createIcons(); // Re-render icons
            chatWindow.scrollTop = chatWindow.scrollHeight; // Auto scroll ke bawah
        }

        // ========================================================================
        // LOGIKA HALAMAN DOWNLOAD PUBLIK
        // ========================================================================
        async function handleDownloadPage(fileId) {
            const downloadLoading = document.getElementById('download-loading');
            const downloadCard = document.getElementById('download-card');
            const downloadNotFound = document.getElementById('download-not-found');
            
            try {
                const { data: fileData, error } = await supabase
                    .from('files')
                    .select('file_name, file_path')
                    .eq('id', fileId)
                    .single(); // Ambil satu data saja

                if (error || !fileData) {
                    throw new Error('File tidak ditemukan di database.');
                }
                
                document.getElementById('download-filename').textContent = fileData.file_name;
                
                downloadLoading.classList.add('hidden');
                downloadNotFound.classList.add('hidden');
                downloadCard.classList.remove('hidden');

                const downloadButton = document.getElementById('download-button');
                downloadButton.onclick = async () => {
                    const buttonText = document.getElementById('download-button-text');
                    const spinner = document.getElementById('download-spinner');
                    
                    buttonText.textContent = 'Memulai download...';
                    spinner.classList.remove('hidden');
                    downloadButton.disabled = true;

                    try {
                        const { data: blobData, error: downloadError } = await supabase.storage
                            .from('uploads')
                            .download(fileData.file_path);
                        
                        if (downloadError) throw downloadError;
                        
                        // Buat link sementara untuk men-trigger download
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blobData);
                        link.download = fileData.file_name;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(link.href);

                        buttonText.textContent = 'Download Selesai';

                    } catch (err) {
                        showMessage(`Gagal mengunduh file: ${err.message}`, 'error');
                        buttonText.textContent = 'Download Gagal, Coba Lagi';
                        downloadButton.disabled = false;
                        spinner.classList.add('hidden');
                    }
                };

            } catch (err) {
                downloadLoading.classList.add('hidden');
                downloadCard.classList.add('hidden');
                downloadNotFound.classList.remove('hidden');
            }
        }
        
    </script>
</body>
</html>
